import 'package:flutter_test/flutter_test.dart';
import 'package:uphf_edt_v2/data/utils/datehelper.dart';

void main() {
  test(
    'Given html page When getDayFromHTML() is called Then the current date is return',
    () {
      // Given
      const html = '''
        <link rel="stylesheet" href="jquery.mobile-1.3.1.css"><link rel="stylesheet" href="calendar.css"><script src="jquery.js"></script><script src="jquery.mobile-1.3.1.js"></script><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html dir="ltr" lang="fr"><head><title>Emploi du temps</title><meta name="generator" content="Apache MyFaces Trinidad"><link rel="stylesheet" charset="UTF-8" type="text/css" href="/esup-vtclient-up4/adf/styles/cache/minimal-ngipes-ltr-cmp.css;jsessionid=3077B9117EC4BE27011FD3705DD8D8EA"><link rel="apple-touch-icon" href="/media/images/blank-icon.png"><meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0"></head><body onload="_checkLoadNoPPR()"><script type="text/javascript">var _AdfWindowOpenError='Un mécanisme de blocage des fenêtres instantanées a été détecté dans votre navigateur Web. Ce type de mécanisme empêche le bon fonctionnement de cette application. Désactivez le mécanisme de blocage des fenêtres instantanées ou autorisez les fenêtres liées à ce site.';</script><script type="text/javascript" src="/esup-vtclient-up4/adf/jsLibs/Common1_2_14.js;jsessionid=3077B9117EC4BE27011FD3705DD8D8EA"></script><a name="top"></a><noscript>Cette page utilise JavaScript et exige un navigateur Web o&ugrave; JavaScript est activ&eacute;. Ce n'est pas le cas du v&ocirc;tre.</noscript><form id="null:navigation" name="null:navigation" style="margin:0px" method="POST" onkeypress="return _submitOnEnter(event,'null:navigation');" action="/esup-vtclient-up4/stylesheets/mobile/welcome.xhtml;jsessionid=3077B9117EC4BE27011FD3705DD8D8EA"><div class="toolbar"><h1 class="x6x">EDT</h1></div><input type="hidden" name="org.apache.myfaces.trinidad.faces.FORM" value="null:navigation"><input type="hidden" name="_noJavaScript" value="false"><input type="hidden" name="javax.faces.ViewState" value="!1"><script type="text/javascript">function _null_navigationValidator(f,s){return _validateInline(f,s);}var null_navigation_SF={};</script><script type="text/javascript">_submitFormCheck();</script></form><div data-role="page"><div data-role="header"><a href="#" data-role="button" id="btn_prec" data-icon="arrow-l">Prec.</a><h1 style="font-size:14px;">Lundi 21 F&eacute;vrier</h1><a href="#" data-role="button" id="btn_suiv" data-icon="arrow-r">Suiv.</a></div><div data-role="content"><ul data-role="listview" data-theme="d" data-divider-theme="b">            <li data-role="list-divider">LANGAGE ET SCRIPTING (P3IN1LAN)<span class="ui-li-count">DS</span></li>            <li>                    <h3>AB1-011 S (ABEL DE PUJOL1)</h3>                    <p><strong>                    Pr&eacute;sentiel                    </strong></p>                    <p><strong>                    T. DELOT                    </strong></p>                    <p style="color:red;"></p>                    <p style="white-space:normal;padding-top:4px;text-transform: lowercase;font-style:italic">LANGAGE ET SCRIPTING (P3IN1LAN)-DS</p>                    <p class="ui-li-aside" style="width:35%"><strong>                    8:30-10:00                    </strong></p>            </li>            <li data-role="list-divider">INFORMATIQUE 3 (P3IN2IN3)<span class="ui-li-count">DS</span></li>            <li>                    <h3>AB1-011 S (ABEL DE PUJOL1)</h3>                    <p><strong>                                        </strong></p>                    <p><strong>                    C. WILBAUT                    </strong></p>                    <p style="color:red;"></p>                    <p style="white-space:normal;padding-top:4px;text-transform: lowercase;font-style:italic">INFORMATIQUE 3 (P3IN2IN3)-DS</p>                    <p class="ui-li-aside" style="width:35%"><strong>                    10:30-12:00                    </strong></p>            </li>            <li data-role="list-divider">BASESDEDONNEES (P3IN3BAD)<span class="ui-li-count">DS</span></li>            <li>                    <h3>CAR-A COQUET (CARPEAUX)</h3>                    <p><strong>                    Pr&eacute;sentiel                    </strong></p>                    <p><strong>                    C. ROZE                    </strong></p>                    <p style="color:red;"></p>                    <p style="white-space:normal;padding-top:4px;text-transform: lowercase;font-style:italic">BASESDEDONNEES (P3IN3BAD)-DS</p>                    <p class="ui-li-aside" style="width:35%"><strong>                    13:30-15:00                    </strong></p><span style="display:none"></span>            </li>    </ul>           </div><div data-role="footer" data-position="fixed"><div data-role="navbar" data-iconpos="left">        <ul>                    <li><a href="#" data-icon="bars" id="btn_ajd">Ajd</a></li>            <li><a href="#" data-icon="grid" id="btn_cal">Calendrier</a></li>        </ul>    </div></div></div><form id="redirectForm" name="redirectForm" method="POST" onkeypress="return _submitOnEnter(event,'redirectForm');" action="/esup-vtclient-up4/stylesheets/mobile/welcome.xhtml;jsessionid=3077B9117EC4BE27011FD3705DD8D8EA"><input id="redirectForm:semPrec" name="redirectForm:semPrec" type="submit" onclick="submitForm('redirectForm',0,{source:'redirectForm:semPrec'});return false;" style="visibility:hidden;"><input id="redirectForm:semSuiv" name="redirectForm:semSuiv" type="submit" onclick="submitForm('redirectForm',0,{source:'redirectForm:semSuiv'});return false;" style="visibility:hidden;"><input id="redirectForm:resetJ" name="redirectForm:resetJ" type="submit" onclick="submitForm('redirectForm',0,{source:'redirectForm:resetJ'});return false;" style="visibility:hidden;"><input id="redirectForm:goCal" name="redirectForm:goCal" type="submit" onclick="submitForm('redirectForm',0,{source:'redirectForm:goCal'});return false;" style="visibility:hidden;"><input id="redirectForm:changetype" name="redirectForm:changetype" type="submit" onclick="submitForm('redirectForm',0,{source:'redirectForm:changetype'});return false;" style="visibility:hidden;"><input type="hidden" name="org.apache.myfaces.trinidad.faces.FORM" value="redirectForm"><input type="hidden" name="_noJavaScript" value="false"><input type="hidden" name="javax.faces.ViewState" value="!1"><script type="text/javascript">function _redirectFormValidator(f,s){return _validateInline(f,s);}var redirectForm_SF={};</script><script type="text/javascript">_submitFormCheck();</script></form><script type="text/javascript">			('#btn_suiv').on('click', function(){			  document.getElementById("redirectForm:semSuiv").click();			});						('#btn_prec').on('click', function(){			  document.getElementById("redirectForm:semPrec").click();			});						('#btn_ajd').on('click', function(){			  document.getElementById("redirectForm:resetJ").click();			});						('#btn_cal').on('click', function(){			  document.getElementById("redirectForm:goCal").click();			});						('#btn_changetype').on('click', function(){			  document.getElementById("redirectForm:changetype").click();			});						('#btn_menu').on('click', function(){				document.location.href="https://cas.uphf.fr/cas/login?service=https://portail.uphf.fr/Login"; 			});				</script></body><!--Created by Apache Trinidad (Apache MyFaces Trinidad API - 1.2.14/Apache MyFaces Trinidad Impl - 1.2.14), skin:minimal (minimalFamily)--></html>
      ''';

      // When
      DateTime date = DateHelper.getDayFromHTML(html, "div > div > h1");

      // Then
      expect(date, DateTime(1970, 02, 21));
    },
  );

  test(
      'Given DateTime When convertDateTimeToStringUPHFFormat() is called Then DateTime is convert for post request',
      () {
    // Given
    DateTime date = DateTime(1970, 02, 21);

    // When
    String dateString = DateHelper.convertDateTimeToStringUPHFFormat(date);

    // Then
    expect(dateString, "21/02/1970");
  });
}
